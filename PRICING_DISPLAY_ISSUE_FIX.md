# 定价组件显示问题修复总结

## 问题分析

根据图片描述，首页显示的定价计划不是期望的：
- 显示：$9.90, $19.00, $99.00, $199.00, $256.00
- 期望：$29.99, $99.99, $199.99 (月付) + $299.9, $999.9, $1999.9 (年付) + $49.99 (一次性)

## 已完成的修复

### 1. ✅ 数据库积分配置已更新
所有计划的积分已正确设置：
- $29.99/月 → 3,000 积分/月
- $99.99/月 → 110,000 积分/月
- $199.99/月 → 24,000 积分/月
- $299.90/年 → 3,000 积分/月 (12个月)
- $999.90/年 → 110,000 积分/月 (12个月)
- $1999.90/年 → 24,000 积分/月 (12个月)
- $49.99 → 5,000 积分

### 2. ✅ JSONB 格式已修复
所有计划的 `benefits_jsonb` 字段已从字符串格式转换为正确的 JSONB 对象格式。

### 3. ✅ 计划激活状态已更新
已确保只有以下7个计划处于激活状态：
- Basic Plan ($29.99/month)
- Stande Plan ($99.99/month)
- Ultra Plan ($199.99/month)
- Basic Plan ($299.90/year)
- Stande Plan ($999.90/year)
- Ultra Plan ($1999.90/year)
- One-Time Payment ($49.99)

所有其他计划（包括 $9.90, $19, $99, $199, $256 等）都已设置为 INACTIVE。

### 4. ✅ 前端组件已更新
`PricingCardDisplay` 组件已更新，能够正确读取和显示积分信息。

## 可能的原因

如果首页仍然显示错误的计划，可能是以下原因：

1. **浏览器缓存**：浏览器缓存了旧的页面数据
2. **Next.js 缓存**：开发服务器缓存了旧的数据库查询结果
3. **环境变量**：`NODE_ENV` 可能不是 `development`，导致使用了 `live` 环境的计划

## 解决方案

### 步骤 1: 清除浏览器缓存
1. 按 `Ctrl + Shift + R` (Windows) 或 `Cmd + Shift + R` (Mac) 强制刷新
2. 或打开开发者工具，右键刷新按钮，选择"清空缓存并硬性重新加载"

### 步骤 2: 重启开发服务器
```bash
# 停止当前服务器 (Ctrl + C)
# 然后重新启动
pnpm dev
```

### 步骤 3: 验证环境变量
确保 `.env.local` 中没有设置 `NODE_ENV=production`，或者确保使用的是 `test` 环境的计划。

### 步骤 4: 检查数据库
运行以下命令验证：
```bash
pnpm tsx scripts/check-active-pricing-plans.ts
```

应该只显示7个激活的计划。

## 验证步骤

1. **检查数据库**：
   ```bash
   pnpm tsx scripts/check-active-pricing-plans.ts
   ```

2. **检查前端显示**：
   - 访问首页
   - 查看定价部分
   - 应该显示：
     - 月付：$29.99 (3,000积分), $99.99 (110,000积分), $199.99 (24,000积分)
     - 年付：$299.90 (3,000积分/月), $999.90 (110,000积分/月), $1999.90 (24,000积分/月)
     - 一次性：$49.99 (5,000积分)

3. **检查积分显示**：
   - 每个定价卡片应该显示积分信息（带硬币图标）
   - 月付/年付显示 "X credits/month"
   - 一次性显示 "X credits"

## 如果问题仍然存在

如果清除缓存和重启服务器后问题仍然存在，请检查：

1. **数据库连接**：确保应用连接的是正确的数据库
2. **环境变量**：检查 `DATABASE_URL` 是否正确
3. **NODE_ENV**：确保开发环境使用的是 `test` 环境的计划
4. **组件日志**：查看浏览器控制台和服务器日志是否有错误

## 相关文件

- `components/nanabananvideo/Pricing.tsx` - NanoBananaVideo 定价组件
- `components/home/PricingCardDisplay.tsx` - 定价卡片显示组件
- `actions/prices/public.ts` - 获取公共定价计划的 Server Action
- `scripts/check-active-pricing-plans.ts` - 检查激活计划的脚本
- `scripts/ensure-correct-plans-active.ts` - 确保正确计划激活的脚本

