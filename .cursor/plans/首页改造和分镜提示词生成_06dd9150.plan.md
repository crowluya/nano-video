---
name: 首页改造和分镜提示词生成
overview: 改造首页导航栏、添加视频展示区域、重命名视频生成器标题并配置多语言，以及集成 OpenRouter 实现智能分镜提示词生成功能
todos:
  - id: nav-update
    content: 更新导航栏：移除 AI Demo 和 Demo，添加 video generator 和 FAQ 链接（en/zh/ja 三个语言文件）
    status: pending
  - id: video-showcase
    content: 创建 VideoShowcase 组件，实现三个视频依次自动播放（全宽、响应式）
    status: pending
  - id: integrate-showcase
    content: 在首页 Hero 下方集成 VideoShowcase 组件
    status: pending
    dependencies:
      - video-showcase
  - id: multilang-video-gen
    content: 配置视频生成器标题和文本的多语言支持（NanoBananaVideo.json 三个语言文件）
    status: pending
  - id: update-video-gen-ui
    content: 更新 VideoGenerationPage 和 VideoGenerationDemo 组件使用翻译键替换硬编码文本
    status: pending
    dependencies:
      - multilang-video-gen
  - id: storyboard-api
    content: 创建分镜提示词生成 API 路由（集成 OpenRouter，支持 fast/master 模式，Sora2/Veo3.1 逻辑）
    status: pending
  - id: storyboard-ui
    content: 创建 StoryboardPromptGenerator UI 组件（Fast/Master 按钮，加载状态，结果展示）
    status: pending
    dependencies:
      - storyboard-api
  - id: integrate-storyboard
    content: 在 VideoGenerationPage 中集成 StoryboardPromptGenerator（根据模型和图片数量显示）
    status: pending
    dependencies:
      - storyboard-ui
  - id: subscription-check
    content: 实现付费用户检查逻辑（使用 useUserBenefits，控制 Master 模式可用性）
    status: pending
    dependencies:
      - storyboard-ui
---

# 首页改造和分镜提示词生成功能

## 一、导航栏改造

### 1.1 修改导航链接配置

- **文件**: `i18n/messages/en/common.json`, `i18n/messages/zh/common.json`, `i18n/messages/ja/common.json`
- **操作**: 
- 移除 "AI Demo" 和 "Demo" 链接
- 添加 "video generator" 链接（指向 `/#video-demo`）
- 添加 "FAQ" 链接（指向 `/#faq`）
- 最终顺序：Features, "video generator", Pricing, FAQ, Blog

### 1.2 更新 HeaderLinks 组件（如需要）

- **文件**: `components/header/HeaderLinks.tsx`
- **说明**: 确保组件能正确处理新的链接结构

## 二、视频展示区域

### 2.1 创建视频展示组件

- **新文件**: `components/nanabananvideo/VideoShowcase.tsx`
- **功能**:
- 全宽视频展示区域
- 依次播放三个视频（自动播放、循环、静音）
- 视频 URL:

1. `https://tempfile.aiquickdraw.com/v/228e623c000be1ae80b3c6e5b4fd421f_1765983853.mp4`
2. `https://file.aiquickdraw.com/custom-page/akr/section-images/17607764967900u9630hr.mp4`
3. `https://file.aiquickdraw.com/custom-page/akr/section-images/1760692304341bbjb1icx.mp4`

- 响应式设计，支持移动端

### 2.2 集成到首页

- **文件**: `components/nanabananvideo/index.tsx`
- **操作**: 在 Hero 组件后添加 VideoShowcase 组件

## 三、视频生成器标题和多语言

### 3.1 更新翻译文件

- **文件**: `i18n/messages/en/NanoBananaVideo.json`, `i18n/messages/zh/NanoBananaVideo.json`, `i18n/messages/ja/NanoBananaVideo.json`
- **操作**: 
- 在 `VideoDemo` 部分添加 `title: "nano banana video generator"`（各语言版本）
- 确保所有硬编码文本都使用翻译键

### 3.2 更新 VideoGenerationPage 组件

- **文件**: `components/video-generation/VideoGenerationPage.tsx`
- **操作**:
- 将标题 "Video Generation" 改为使用翻译键
- 确保所有文本都支持多语言切换

### 3.3 更新 VideoGenerationDemo 组件

- **文件**: `components/nanabananvideo/VideoGenerationDemo.tsx`
- **操作**: 使用翻译键替换硬编码文本

## 四、分镜提示词生成功能

### 4.1 创建 OpenRouter API 路由

- **新文件**: `app/api/ai-demo/generate-storyboard-prompt/route.ts`
- **功能**:
- 接收图片（base64 或 URL）和模型选择（fast/master）
- 调用 OpenRouter API（google/gemini-2.5-flash 或 google/gemini-2.5-flash-lite）
- 实现专业级电影提示词生成逻辑：
- 识别图像对象、风格等信息
- 生成包含情绪、主体、光线、相机角度、运镜、镜头类型、光圈、方向、镜头逻辑、细节材质等的提示词
- 叠加否定材质、否定风格路径
- 避免状态和动作混淆
- 保留构图偏差、光线不均匀、动作未完成状态等
- 支持 Sora2（单图片）和 Veo3.1（双图片首尾帧）

### 4.2 创建提示词生成 UI 组件

- **新文件**: `components/video-generation/StoryboardPromptGenerator.tsx`
- **功能**:
- 显示 "Fast" 和 "Master" 两个按钮
- 根据用户订阅状态决定可用模型（付费用户可用 Master）
- 显示生成中的加载状态
- 显示生成的提示词（可编辑）
- 支持将生成的提示词填充到主提示词输入框

### 4.3 集成到 VideoGenerationPage

- **文件**: `components/video-generation/VideoGenerationPage.tsx`
- **操作**:
- 在图片上传区域下方添加 StoryboardPromptGenerator 组件
- 根据选择的模型（Sora2/Veo3.1）和图片数量显示/隐藏组件
- Sora2: 单图片时显示
- Veo3.1: 双图片时显示（首尾帧模式）

### 4.4 检查用户订阅状态

- **文件**: `components/video-generation/StoryboardPromptGenerator.tsx`
- **逻辑**: 
- 使用 `useUserBenefits` hook 获取用户订阅状态
- 如果 `subscriptionStatus === 'active'` 或 `subscriptionStatus === 'trialing'`，允许使用 Master 模式
- 否则只显示 Fast 模式

## 五、技术实现细节

### 5.1 OpenRouter 集成

- **使用**: `lib/ai-model-factory.ts` 中的 `createAIModel` 函数
- **模型**:
- Fast: `google/gemini-2.5-flash-lite` (via OpenRouter)
- Master: `google/gemini-2.5-flash` (via OpenRouter)
- **环境变量**: 确保 `OPENROUTER_API_KEY` 已配置

### 5.2 提示词生成 Prompt 设计

- **系统提示词**: 包含专业电影制作指导原则
- **用户输入**: 图片（base64）和可选的用户描述
- **输出格式**: 结构化的电影级提示词

### 5.3 图片处理

- **Sora2**: 单图片 → 生成单分镜提示词
- **Veo3.1**: 双图片（首尾帧）→ 生成首尾帧之间的过渡提示词

## 六、文件清单

### 修改的文件

1. `i18n/messages/en/common.json` - 导航链接
2. `i18n/messages/zh/common.json` - 导航链接
3. `i18n/messages/ja/common.json` - 导航链接
4. `i18n/messages/en/NanoBananaVideo.json` - 视频生成器标题和文本
5. `i18n/messages/zh/NanoBananaVideo.json` - 视频生成器标题和文本
6. `i18n/messages/ja/NanoBananaVideo.json` - 视频生成器标题和文本
7. `components/nanabananvideo/index.tsx` - 添加 VideoShowcase
8. `components/video-generation/VideoGenerationPage.tsx` - 集成分镜提示词生成器
9. `components/nanabananvideo/VideoGenerationDemo.tsx` - 使用翻译键

### 新建的文件

1. `components/nanabananvideo/VideoShowcase.tsx` - 视频展示组件
2. `app/api/ai-demo/generate-storyboard-prompt/route.ts` - 分镜提示词生成 API
3. `components/video-generation/StoryboardPromptGenerator.tsx` - 分镜提示词生成 UI

## 七、实现顺序

1. **Phase 1**: 导航栏改造（简单，影响范围小）
2. **Phase 2**: 视频展示区域（独立组件，易于测试）
3. **Phase 3**: 多语言配置（确保所有文本可切换）
4. **Phase 4**: 分镜提示词生成功能（最复杂，需要 API 集成和 UI 开发）