---
description: ä¸Šçº¿å‰éƒ¨ç½²æ£€æŸ¥ï¼ŒéªŒè¯ç¯å¢ƒã€æ„å»ºã€å®‰å…¨ç­‰
model: opus
allowed-tools:
  - Read
  - Bash
  - Grep
  - Glob
---

# éƒ¨ç½²å‰æ£€æŸ¥æŒ‡ä»¤

ä½ æ˜¯ä¸€ä½ DevOps å·¥ç¨‹å¸ˆï¼Œè´Ÿè´£ä¸Šçº¿å‰çš„å…¨é¢æ£€æŸ¥ã€‚

## æ‰§è¡Œæ­¥éª¤

### 1. ç¯å¢ƒå˜é‡æ£€æŸ¥

```bash
# æ£€æŸ¥ .env.example å­˜åœ¨
!test -f .env.example && echo "âŒ .env.example ä¸å­˜åœ¨" || echo "âœ… .env.example å­˜åœ¨"

# æ£€æŸ¥å…³é”®ç¯å¢ƒå˜é‡æ–‡æ¡£
!grep -E "DATABASE_URL|BETTER_AUTH_SECRET|STRIPE_SECRET_KEY|CREEM_API_KEY|R2_" .env.example
```

å¯¹ç…§ `.cursor/rules/12-env-variables.mdc` æ£€æŸ¥ï¼š
- [ ] æ•°æ®åº“é…ç½® (DATABASE_URL)
- [ ] è®¤è¯é…ç½® (BETTER_AUTH_SECRET, OAuth keys)
- [ ] æ”¯ä»˜é…ç½® (Stripe, Creem)
- [ ] å­˜å‚¨é…ç½® (R2)
- [ ] AI æœåŠ¡é…ç½® (API keys)
- [ ] é‚®ä»¶é…ç½® (Resend)

### 2. ä»£ç è´¨é‡æ£€æŸ¥

```bash
# TypeScript ç±»å‹æ£€æŸ¥
!pnpm tsc --noEmit

# ESLint æ£€æŸ¥
!pnpm lint

# å®‰å…¨å®¡è®¡
!pnpm audit
```

### 3. æ„å»ºéªŒè¯

```bash
# ç”Ÿäº§æ„å»º
!pnpm build

# æ£€æŸ¥æ„å»ºè¾“å‡º
!ls -la .next/static/
```

### 4. æ•°æ®åº“æ£€æŸ¥

```bash
# æ£€æŸ¥è¿ç§»çŠ¶æ€
!pnpm db:generate

# æ£€æŸ¥æ˜¯å¦æœ‰æœªåº”ç”¨çš„è¿ç§»
!ls -la lib/db/migrations/
```

### 5. å®‰å…¨æ‰«æ

```bash
# æ£€æŸ¥ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
!grep -r "sk_live_" app/ --exclude-dir=node_modules || echo "âœ… æ— ç¡¬ç¼–ç  Stripe keys"
!grep -r "API_KEY.*=" app/ --exclude-dir=node_modules | grep -v "process.env" | grep -v "NEXT_PUBLIC" || echo "âœ… æ— ç¡¬ç¼–ç  API keys"

# æ£€æŸ¥ .env æ–‡ä»¶
!git ls-files | grep "\.env$" && echo "âŒ .env æ–‡ä»¶è¢«è¿½è¸ª" || echo "âœ… .env æ–‡ä»¶æœªè¢«è¿½è¸ª"
```

### 6. i18n å®Œæ•´æ€§æ£€æŸ¥

è°ƒç”¨ `/i18n-check app/` æ£€æŸ¥ï¼š
- ç¡¬ç¼–ç æ–‡æœ¬
- ç¼ºå¤±çš„ç¿»è¯‘ key

### 7. ä¾èµ–æ£€æŸ¥

```bash
# æ£€æŸ¥è¿‡æ—¶çš„ä¾èµ–
!pnpm outdated

# æ£€æŸ¥æ˜¯å¦æœ‰æœªä½¿ç”¨çš„ä¾èµ–
!cat package.json | grep -A 100 "dependencies"
```

### 8. æ”¯ä»˜ç³»ç»Ÿæ£€æŸ¥

å¯¹ç…§ `.cursor/rules/09-payments.mdc`ï¼š
- [ ] Webhook ç«¯ç‚¹é…ç½®
- [ ] Idempotency é€»è¾‘
- [ ] ç§¯åˆ†æ“ä½œäº‹åŠ¡
- [ ] é€€æ¬¾éªŒè¯

### 9. æ€§èƒ½æ£€æŸ¥

```bash
# åˆ†æ bundle å¤§å°
!pnpm analyze
```

æ£€æŸ¥ï¼š
- [ ] é¦–å± JS ä½“ç§¯
- [ ] å¤§å‹ chunk è¯†åˆ«
- [ ] ä»£ç åˆ†å‰²æœºä¼š

### 10. é…ç½®æ–‡ä»¶æ£€æŸ¥

- [ ] `next.config.mjs` - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
- [ ] `tailwind.config.ts` - CSS ä¼˜åŒ–
- [ ] `tsconfig.json` - ä¸¥æ ¼æ¨¡å¼
- [ ] `.gitignore` - æ•æ„Ÿæ–‡ä»¶æ’é™¤

## ç”ŸæˆæŠ¥å‘Š

è¾“å‡ºä¸€ä»½ Markdown æŠ¥å‘Šï¼š

```markdown
# éƒ¨ç½²å‰æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´**: {{TIMESTAMP}}
**æ£€æŸ¥äºº**: AI Assistant

---

## æ€»ä½“çŠ¶æ€: âš ï¸ æœ‰ X é¡¹éœ€è¦å¤„ç†

---

## âœ… é€šè¿‡çš„æ£€æŸ¥ (X/Y)

- [âœ…] ç¯å¢ƒå˜é‡æ–‡æ¡£å®Œæ•´
- [âœ…] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- [âœ…] ESLint æ£€æŸ¥é€šè¿‡
- ...

---

## âŒ å¤±è´¥çš„æ£€æŸ¥ (X/Y)

### é«˜ä¼˜å…ˆçº§ (å¿…é¡»ä¿®å¤)

1. **ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯**
   - æ–‡ä»¶: `app/api/stripe.ts:25`
   - é—®é¢˜: ç¡¬ç¼–ç äº† `sk_live_` å¼€å¤´çš„ key
   - ä¿®å¤: ä½¿ç”¨ç¯å¢ƒå˜é‡

2. **i18n ç¼ºå¤±**
   - æ–‡ä»¶: `components/feature/card.tsx`
   - é—®é¢˜: ç¡¬ç¼–ç æ–‡æœ¬ "Loading..."
   - ä¿®å¤: ä½¿ç”¨ `t('common.loading')`

### ä¸­ä¼˜å…ˆçº§ (å»ºè®®ä¿®å¤)

1. **è¿‡æ—¶ä¾èµ–**
   - åŒ…: `lodash@4.17.21` â†’ `4.17.22` å­˜åœ¨å®‰å…¨æ›´æ–°
   - å»ºè®®: è¿è¡Œ `pnpm update lodash`

### ä½ä¼˜å…ˆçº§ (å¯é€‰)

1. **Bundle ä½“ç§¯**
   - é—®é¢˜: é¦–å± JS 250KBï¼Œå»ºè®® < 200KB
   - å»ºè®®: ä½¿ç”¨åŠ¨æ€å¯¼å…¥

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ•æ„Ÿä¿¡æ¯æ³„éœ² | âœ… | æ— ç¡¬ç¼–ç å¯†é’¥ |
| .env è¿½è¸ª | âœ… | æ­£ç¡®é…ç½® |
| SQL æ³¨å…¥é£é™© | âœ… | ä½¿ç”¨ Drizzle ORM |
| XSS é£é™© | âœ… | React é»˜è®¤é˜²æŠ¤ |

---

## ğŸ“Š æ€§èƒ½æ£€æŸ¥

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | çŠ¶æ€ |
|------|------|------|------|
| é¦–å± JS | 250KB | <200KB | âš ï¸ |
| Lighthouse | 85 | >90 | âœ… |
| TTI | 1.2s | <2s | âœ… |

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç«‹å³æ‰§è¡Œ
1. ä¿®å¤é«˜ä¼˜å…ˆçº§å®‰å…¨é—®é¢˜
2. ä¿®å¤ i18n ç¼ºå¤±

### ä¸Šçº¿åç›‘æ§
1. ç›‘æ§é”™è¯¯ç‡
2. ç›‘æ§æ”¯ä»˜ webhook
3. ç›‘æ§æ€§èƒ½æŒ‡æ ‡

---

**å¤æŸ¥å‘½ä»¤**: `/check-deploy`
```

## å¼€å§‹

å¼€å§‹æ‰§è¡Œéƒ¨ç½²å‰æ£€æŸ¥...
